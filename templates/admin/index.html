{% extends "admin/index.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    /* Dashboard Stats Overlay */
    .dashboard-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .dashboard-card {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .card-info h3 {
        font-size: 0.8rem;
        color: #718096;
        margin: 0;
    }

    .card-info p {
        font-size: 1.4rem;
        font-weight: 700;
        margin: 5px 0 0 0;
    }

    .card-icon {
        width: 45px;
        height: 45px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }

    .icon-rev {
        background: rgba(0, 123, 255, 0.1);
        color: #007bff;
    }

    .icon-ord {
        background: rgba(40, 167, 69, 0.1);
        color: #28a745;
    }

    .icon-book {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
    }

    .charts-row {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }

    .chart-box {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }

    @media (max-width: 768px) {
        .charts-row {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div id="content-main">
    <!-- Professional Dashboard Header -->
    <div class="dashboard-stats">
        <div class="dashboard-card">
            <div class="card-info">
                <h3>Total Revenue</h3>
                <p id="dash-revenue">KES ...</p>
            </div>
            <div class="card-icon icon-rev"><i class="fas fa-coins"></i></div>
        </div>
        <div class="dashboard-card">
            <div class="card-info">
                <h3>Total Orders</h3>
                <p id="dash-orders">...</p>
            </div>
            <div class="card-icon icon-ord"><i class="fas fa-shopping-bag"></i></div>
        </div>
        <div class="dashboard-card">
            <div class="card-info">
                <h3>Pending Bookings</h3>
                <p id="dash-bookings">...</p>
            </div>
            <div class="card-icon icon-book"><i class="fas fa-clock"></i></div>
        </div>
    </div>

    <!-- Charts row -->
    <div class="charts-row">
        <div class="chart-box">
            <h4 style="margin-top: 0; color: #4a5568;">Revenue Overview</h4>
            <canvas id="adminRevenueChart" height="100"></canvas>
        </div>
        <div class="chart-box">
            <h4 style="margin-top: 0; color: #4a5568;">Booking Status</h4>
            <canvas id="adminBookingChart"></canvas>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/api/admin/dashboard-stats/');
                const data = await response.json();

                document.getElementById('dash-revenue').innerText = 'KES ' + data.total_revenue.toLocaleString();
                document.getElementById('dash-orders').innerText = data.total_orders;
                document.getElementById('dash-bookings').innerText = data.pending_bookings;

                // Revenue Chart
                new Chart(document.getElementById('adminRevenueChart'), {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Revenue',
                            data: [12000, 19000, 15000, 25000, 22000, 30000, 28000],
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.05)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: { plugins: { legend: { display: false } }, scales: { y: { display: false } } }
                });

                // Booking Chart
                const bData = data.booking_status_distribution;
                new Chart(document.getElementById('adminBookingChart'), {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(bData),
                        datasets: [{
                            data: Object.values(bData),
                            backgroundColor: ['#ffc107', '#17a2b8', '#28a745', '#dc3545']
                        }]
                    },
                    options: { cutout: '70%', plugins: { legend: { position: 'bottom' } } }
                });

            } catch (e) { console.error('Dashboard load failed', e); }
        });
    </script>

    {{ block.super }}
</div>
{% endblock %}